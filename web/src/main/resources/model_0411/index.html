<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦å–®</title>
    <link rel="stylesheet" href="./css/god-willing.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/widget-calendar-custom.css">
    <link rel="stylesheet" href="./css/history-manager.css">
    <link rel="stylesheet" href="./css/illustrate-score.css">
    <!-- å¼•å…¥ Web Components çš„ Polyfill -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/2.4.4/webcomponents-bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/3.1.1/dom-to-image-more.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="module" src="../calendar-main/src/calendar.js"></script>
    <script type="module" src="../calendar-main/src/widget-calendar.js"></script>
</head>
<body>
    <!-- æ­·å²è¨˜éŒ„æŒ‰éˆ• -->
    <button id="history-btn" class="history-btn">ğŸ“œ</button>
    
    <!-- æ­·å²è¨˜éŒ„è¦–çª— -->
    <div class="history-overlay"></div>
    <div class="history-container">
        <div class="history-header">
            <h2>æ­·å²è¨˜éŒ„</h2>
            <button class="history-close-btn">X</button>
        </div>
        <div class="history-toolbar">
            <div class="toolbar-left">
                <button id="select-all-btn">å…¨é¸</button>
                <button class="toolbar-left" id="delete-selected-btn">åˆªé™¤é¸ä¸­</button>
            </div>
            <div class="toolbar-right">
                <select id="download-format">
                    <option value="jpeg">JPEG</option>
                    <option value="pdf">PDF</option>
                </select>
                <button id="download-selected-btn">ä¸‹è¼‰é¸ä¸­</button>
            </div>
        </div>
        <div id="history-records" class="history-records"></div>
    </div>

    <div id="record-preview-container" class="record-preview-container"></div>
    
    <div class="content-wrapper">
        <div class="god-willing">
            <div class="mainGod">ç”¨ç¥ï¼š</div>
            <div class="mainGodInfo">main</div>
            <div class="sun">æ—¥è¾°ï¼š</div>
            <div class="sunInfo">sun</div>
            <div class="moon">æœˆå»ºï¼š</div>
            <div class="moonInfo">moon</div>
            <div class="willing">å¤©æ„ï¼š</div>
            <div class="willingInfo">willing</div>
        </div>
        <div class="illustate-score">
            <div class="totalScore">totalScore</div>
        </div>
    </div>

    <div class="parent">
        <div class="div1">å¹´</div>
        <div class="div2">æœˆ</div>
        <div class="div3">æ—¥</div>
        <div class="div4">æ™‚</div>
        <div class="div5">æœˆç ´</div>
        <div class="div6">æ—¥æ²–</div>
        <div class="div7">ç©ºäº¡</div>
        <div class="div8">å¦èº«</div>
        <div class="div9">9</div>
        <div class="div10">10</div>
        <div class="div12">12</div>
        <div class="div13"></div>
        <div class="div14">14</div>
        <div class="div15">15</div>
        <div class="div16">16</div>
        <div class="div17">17</div>
        <div class="div18">é¦–å¦</div>
        <div class="div19">åŸå¦</div>
        <div class="div20">ç”¨ç¥</div>
        <div class="div21">åŸç¥</div>
        <div class="div22">å¿Œç¥</div>
        <div class="div23">ä»‡ç¥</div>
        <div class="div24">é–’ç¥</div>
        <div class="div25">è®Šå¦</div>
        <div class="div26">26</div>
        <div class="div27">27</div>
        <div class="div28">
            <select class="six-relation-select">
                <option value="è²¡">è²¡</option>
                <option value="å­">å­</option>
                <option value="å…„">å…„</option>
                <option value="çˆ¶">çˆ¶</option>
                <option value="å®˜">å®˜</option>
            </select>
        </div>
        <div class="div29">29</div>
        <div class="div30">30</div>
        <div class="div31">31</div>
        <div class="div32">32</div>
        <div class="div33">33</div>
        <div class="div34">ä¼ç¥</div>
        <div class="div35">å…­è¦ª</div>
        <div class="div36">å¹²æ”¯</div>
        <div class="div37">ä¸–æ‡‰</div>
        <div class="div38">åŸçˆ»</div>
        <div class="div39">è®Šçˆ»</div>
        <div class="div40">å¹²æ”¯</div>
        <div class="div41">å…­è¦ª</div>
        <div class="div42">42</div>
        <div class="div43">43</div>
        <div class="div44">44</div>
        <div class="div45">45</div>
        <div class="div46">46</div>
        <div class="div47">47</div>
        <div class="div48">48</div>
        <div class="div49">49</div>
        <div class="div50">50</div>
        <div class="div51">51</div>
        <div class="div52">52</div>
        <div class="div53">53</div>
        <div class="div54">54</div>
        <div class="div55">55</div>
        <div class="div56">56</div>
        <div class="div57">57</div>
        <div class="div58">58</div>
        <div class="div59">59</div>
        <div class="div60">60</div>
        <div class="div61">61</div>
        <div class="div62">62</div>
        <div class="div63">63</div>
        <div class="div64">64</div>
        <div class="div65">65</div>
        <select class="div66 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <select class="div67 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <select class="div68 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <select class="div69 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <select class="div70 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <select class="div71 original-yao">
            <option value="/">/</option>
            <option value="//">//</option>
            <option value="O">O</option>
            <option value="X">X</option>
        </select>
        <div class="div72">72</div>
        <div class="div73">73</div>
        <div class="div74">74</div>
        <div class="div75">75</div>
        <div class="div76">76</div>
        <div class="div77">77</div>
        <div class="div78">78</div>
        <div class="div79">79</div>
        <div class="div80">80</div>
        <div class="div81">81</div>
        <div class="div82">82</div>
        <div class="div83">83</div>
        <div class="div84">84</div>
        <div class="div85">85</div>
        <div class="div86">86</div>
        <div class="div87">87</div>
        <div class="div88">88</div>
        <div class="div89">89</div>
        
        <button id="query-btn" class="query-button">æŸ¥è©¢</button>
        <button id="store-btn" class="store-button">å„²å­˜</button>

        <textarea class="askInfo" placeholder="è«‹ç¤ºï¼š"></textarea>

        <div class="first-yao">first-yao</div>
        <div class="second-yao">second-yao</div>
        <div class="third-yao">third-yao</div>
        <div class="fourth-yao">fourth-yao</div>
        <div class="fifth-yao">fifth-yao</div>
        <div class="sixth-yao">sixth-yao</div>

    </div>

    <!-- æ—¥æ›†é¸æ“‡å™¨ -->
    <button id="calendar-toggle-btn" class="calendar-toggle-btn">é¸æ“‡æ—¥æœŸ</button>
    <div class="calendar-overlay"></div>
    <div class="calendar-container">
        <button class="calendar-close-btn">X</button>
        <widget-calendar class="widget-calendar" date=""></widget-calendar>
    </div>

    <script type="module">
        import { updateDate, updateGua, updateSixRelations } from './javascript/lunar-utils.js';
        import { toggleCalendar } from './javascript/calendar-ui.js';
        import './javascript/history-manager.js';
        import {updateScoreDisplay} from"./javascript/illustrate-score.js";

        // æ·»åŠ æŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.getElementById('query-btn').addEventListener('click', function(e){
            updateGua();
            // æŸ¥è©¢å¾Œæ›´æ–°åˆ†æ•¸é¡¯ç¤º
            setTimeout(updateScoreDisplay, 100); // çµ¦äºˆä¸€äº›æ™‚é–“è®“å…¶ä»–æ›´æ–°å®Œæˆ
        });
        
        // ç›£è½å…­è¦ªé¸æ“‡è®ŠåŒ–
        document.querySelector('.div28').addEventListener('change', function(e) {
            updateSixRelations(e.target.value);
            setTimeout(updateScoreDisplay, 100);
        });

        // ç›£è½åŸçˆ»é¸å–®è®ŠåŒ–
        document.querySelector('.parent').addEventListener('change', function (e) {
            if (e.target.classList.contains('original-yao')) {
                updateGua();
                e.target.setAttribute('data-selected', e.target.value);
                setTimeout(updateScoreDisplay, 100);
            }
        });

        // æ—¥æœŸè®Šæ›´
        document.querySelector('widget-calendar').addEventListener('onChange',function(event){
            updateDate(event);
            //toggleCalendar(); // é¸æ“‡æ—¥æœŸå¾Œè‡ªå‹•é—œé–‰æ—¥æ›†
        });
        
        // document.addEventListener('DOMContentLoaded', function() {
        //     // è¨­ç½®æ—¥æœŸé¸æ“‡å™¨çš„é»˜èªå€¼ç‚ºä»Šå¤©
        //     const datePicker = document.getElementById('date-picker');
        //     const today = new Date();
        //     const formattedDate = today.toISOString().split('T')[0];
        //     datePicker.value = formattedDate;
            
        //     // åˆå§‹åŒ–æ›´æ–°æ—¥æœŸä¿¡æ¯
        //     updateDateInfo(today);
            
        //     // æ·»åŠ æ—¥æœŸé¸æ“‡å™¨çš„changeäº‹ä»¶
        //     datePicker.addEventListener('change', function() {
        //         console.log("æ—¥æœŸå·²è®Šæ›´ï¼Œè‡ªå‹•æ›´æ–°");
        //         const selectedDate = new Date(this.value);
        //         updateDateInfo(selectedDate);
        //     });
            
        //     // ä¿ç•™æ›´æ–°æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ä½œç‚ºå‚™ç”¨
        //     document.getElementById('update-date-btn').addEventListener('click', function() {
        //         console.log("æ‰‹å‹•æ›´æ–°æ—¥æœŸ");
        //         const selectedDate = new Date(datePicker.value);
        //         updateDateInfo(selectedDate);
        //     });
            
        //     // æ›´æ–°æ—¥æœŸä¿¡æ¯çš„å‡½æ•¸
        //     function updateDateInfo(date) {
        //         console.log("æ›´æ–°æ—¥æœŸ");
        //         // ä½¿ç”¨lunar-utils.jsä¸­çš„å‡½æ•¸ç²å–è¾²æ›†ä¿¡æ¯
        //         const lunarInfo = lunarUtils.getSolarToLunar(date);
        //         const info = calendar.getToday();
        //         console.log(info);

        //         // æ›´æ–°å¹´æœˆæ—¥çš„å…¬æ›†å’Œè¾²æ›†ä¿¡æ¯
        //         const div9 = document.querySelector('.div9'); // å¹´
        //         const div10 = document.querySelector('.div10'); // æœˆ
        //         const div12 = document.querySelector('.div12'); // æ—¥
                
        //         // æ ¼å¼åŒ–å…¬æ›†å¹´æœˆæ—¥
        //         const year = date.getFullYear();
        //         const month = date.getMonth() + 1;
        //         const day = date.getDate();
                
        //         // æ›´æ–°é¡¯ç¤ºå…§å®¹
        //         div9.textContent = `${year}å¹´\n${lunarInfo.yearGanZhi}`;
        //         div10.textContent = `${month}æœˆ\n${lunarInfo.monthGanZhi}`;
        //         div12.textContent = `${day}æ—¥\n${lunarInfo.dayGanZhi}`;
        //     }
        // });
    </script>
</body>